<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campo Minado</title>
    <link rel="stylesheet" href="campo_minado.css">
</head>
<body>
    <div class="container">
        <h1>üéØ Campo Minado</h1>
        
        <div class="controles-dificuldade">
            <button class="botao-dificuldade ativo" data-dificuldade="facil">F√°cil (9x9 - 10 minas)</button>
            <button class="botao-dificuldade" data-dificuldade="intermediario">Intermedi√°rio (16x16 - 40 minas)</button>
            <button class="botao-dificuldade" data-dificuldade="dificil">Dif√≠cil (16x30 - 99 minas)</button>
        </div>

        <div class="controles-jogo">
            <div class="contador contador-minas">
                <span>üí£</span>
                <span id="minas-restantes">10</span>
            </div>
            
            <button class="botao-reiniciar" id="reiniciar">
                <span id="emoji-reiniciar">üòä</span>
                Reiniciar
            </button>
            
            <div class="contador contador-tempo">
                <span>‚è±Ô∏è</span>
                <span id="tempo">000</span>
            </div>
        </div>

        <div id="tabuleiro-container" class="tabuleiro-container">
            <!-- Tabuleiro ser√° gerado dinamicamente pelo JavaScript -->
        </div>

        <div id="mensagem-jogo" class="mensagem-jogo"></div>

        <div class="instrucoes">
            <h3>üéÆ Como Jogar:</h3>
            <p><strong>Clique Esquerdo:</strong> Revelar c√©lula</p>
            <p><strong>Clique Direito:</strong> Colocar/remover bandeira (üö©)</p>
            <p><strong>Clique Duplo:</strong> Revelar c√©lulas adjacentes (quando n√∫mero coincide com bandeiras)</p>
        </div>
    </div>

    <script src="campo_minado.js"></script>
    <script>
        class InterfaceCampoMinado {
            constructor() {
                this.jogo = null;
                this.dificuldadeAtual = 'facil';
                this.configuracoes = {
                    facil: { largura: 9, altura: 9, minas: 10 },
                    intermediario: { largura: 16, altura: 16, minas: 40 },
                    dificil: { largura: 30, altura: 16, minas: 99 }
                };
                
                this.inicializarElementos();
                this.inicializarEventos();
                this.novoJogo();
            }

            inicializarElementos() {
                this.tabuleiroContainer = document.getElementById('tabuleiro-container');
                this.minasRestantesElement = document.getElementById('minas-restantes');
                this.tempoElement = document.getElementById('tempo');
                this.botaoReiniciar = document.getElementById('reiniciar');
                this.emojiReiniciar = document.getElementById('emoji-reiniciar');
                this.mensagemJogo = document.getElementById('mensagem-jogo');
                this.botoesDificuldade = document.querySelectorAll('.botao-dificuldade');
            }

            inicializarEventos() {
                this.botaoReiniciar.addEventListener('click', () => this.novoJogo());
                
                this.botoesDificuldade.forEach(botao => {
                    botao.addEventListener('click', (e) => {
                        this.alterarDificuldade(e.target.dataset.dificuldade);
                    });
                });

                // Eventos de teclado
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'r' || e.key === 'R') {
                        this.novoJogo();
                    }
                });
            }

            alterarDificuldade(dificuldade) {
                this.dificuldadeAtual = dificuldade;
                
                // Atualizar bot√µes ativos
                this.botoesDificuldade.forEach(botao => {
                    botao.classList.toggle('ativo', botao.dataset.dificuldade === dificuldade);
                });
                
                this.novoJogo();
            }

            novoJogo() {
                const config = this.configuracoes[this.dificuldadeAtual];
                this.jogo = new CampoMinado(config.largura, config.altura, config.minas);
                
                this.atualizarInterface();
                this.criarTabuleiro();
                this.esconderMensagem();
                this.atualizarEmojiReiniciar('üòä');
            }

            criarTabuleiro() {
                this.tabuleiroContainer.innerHTML = '';
                const tabuleiro = document.createElement('div');
                tabuleiro.className = 'tabuleiro';
                
                // Configurar grid
                tabuleiro.style.gridTemplateColumns = `repeat(${this.jogo.largura}, 35px)`;
                
                for (let y = 0; y < this.jogo.altura; y++) {
                    for (let x = 0; x < this.jogo.largura; x++) {
                        const celula = document.createElement('div');
                        celula.className = 'celula';
                        celula.dataset.x = x;
                        celula.dataset.y = y;
                        
                        // Eventos da c√©lula
                        celula.addEventListener('click', (e) => this.cliqueEsquerdo(x, y, e));
                        celula.addEventListener('contextmenu', (e) => this.cliqueDireito(x, y, e));
                        celula.addEventListener('dblclick', (e) => this.cliqueDuplo(x, y, e));
                        
                        // Prevenir menu de contexto padr√£o
                        celula.addEventListener('contextmenu', (e) => e.preventDefault());
                        
                        tabuleiro.appendChild(celula);
                    }
                }
                
                this.tabuleiroContainer.appendChild(tabuleiro);
            }

            cliqueEsquerdo(x, y, evento) {
                if (this.jogo.jogoAcabou) return;
                
                this.jogo.revelarCelula(x, y);
                this.atualizarInterface();
                
                if (this.jogo.jogoAcabou) {
                    this.fimDeJogo();
                }
            }

            cliqueDireito(x, y, evento) {
                evento.preventDefault();
                if (this.jogo.jogoAcabou) return;
                
                this.jogo.alternarBandeira(x, y);
                this.atualizarInterface();
            }

            cliqueDuplo(x, y, evento) {
                if (this.jogo.jogoAcabou) return;
                
                this.jogo.cliqueDuplo(x, y);
                this.atualizarInterface();
                
                if (this.jogo.jogoAcabou) {
                    this.fimDeJogo();
                }
            }

            atualizarInterface() {
                this.atualizarTabuleiro();
                this.atualizarContadores();
                this.atualizarTempo();
            }

            atualizarTabuleiro() {
                const celulas = document.querySelectorAll('.celula');
                
                celulas.forEach(celulaElement => {
                    const x = parseInt(celulaElement.dataset.x);
                    const y = parseInt(celulaElement.dataset.y);
                    const estado = this.jogo.getEstadoCelula(x, y);
                    
                    // Reset classes
                    celulaElement.className = 'celula';
                    celulaElement.textContent = '';
                    celulaElement.removeAttribute('data-valor');
                    
                    if (estado.revelada) {
                        celulaElement.classList.add('revelada');
                        
                        if (estado.temMina) {
                            celulaElement.classList.add('mina-revelada');
                        } else if (estado.valor > 0) {
                            celulaElement.textContent = estado.valor;
                            celulaElement.setAttribute('data-valor', estado.valor);
                        }
                    } else {
                        if (estado.bandeira) {
                            celulaElement.classList.add('bandeira');
                        } else if (estado.interroga√ß√£o) {
                            celulaElement.classList.add('interrogacao');
                        }
                    }
                });
            }

            atualizarContadores() {
                this.minasRestantesElement.textContent = this.jogo.getMinasRestantes().toString().padStart(3, '0');
            }

            atualizarTempo() {
                this.tempoElement.textContent = this.jogo.getTempo().toString().padStart(3, '0');
            }

            atualizarEmojiReiniciar(emoji) {
                this.emojiReiniciar.textContent = emoji;
            }

            fimDeJogo() {
                if (this.jogo.vitoria) {
                    this.mostrarMensagem('üéâ Parab√©ns! Voc√™ venceu! üéâ', 'mensagem-vitoria');
                    this.atualizarEmojiReiniciar('üòé');
                    document.querySelector('.tabuleiro').classList.add('vitoria');
                } else {
                    this.mostrarMensagem('üí• Game Over! Tente novamente! üí•', 'mensagem-derrota');
                    this.atualizarEmojiReiniciar('üòµ');
                }
                
                // Atualizar tabuleiro final
                this.atualizarTabuleiro();
            }

            mostrarMensagem(texto, tipo) {
                this.mensagemJogo.textContent = texto;
                this.mensagemJogo.className = `mensagem-jogo mostrar ${tipo}`;
            }

            esconderMensagem() {
                this.mensagemJogo.className = 'mensagem-jogo';
                document.querySelector('.tabuleiro')?.classList.remove('vitoria');
            }
        }

        // Inicializar o jogo quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            new InterfaceCampoMinado();
        });

        // Atualizar tempo a cada segundo
        setInterval(() => {
            if (window.interfaceCampoMinado && window.interfaceCampoMinado.jogo?.estaAtivo()) {
                window.interfaceCampoMinado.atualizarTempo();
            }
        }, 1000);
    </script>
</body>
</html>
